{"title":"Dashboard","scrolling":true,"loadflow":"var localUserLoaded, localUserReq;\nOF.GA.setAccount('UA-3107048-21', 'spotlight.android.openfeint.com');\n$.loadScript('dashboard/dashboard');\nif ((typeof jasmine !== \"undefined\" && jasmine !== null) && OF.isBrowser) {\n  $.loadCss('settings/spec');\n}\nlocalUserLoaded = localUserReq = null;\nOF.loadLocalUser = function() {\n  if (OF.user.isLoaded) {\n    return typeof localUserLoaded === \"function\" ? localUserLoaded() : void 0;\n  } else {\n    return localUserReq || (localUserReq = OF.api(\"/xp/users/me\", {\n      success: function(userData) {\n        OF.user = userData.user;\n        OF.user.isLoaded = true;\n        if (typeof localUserLoaded === \"function\") {\n          localUserLoaded();\n        }\n        return localUserLoaded = localUserReq = null;\n      }\n    }));\n  }\n};\nOF.localUserLoaded = function(callback) {\n  if (OF.user.isLoaded) {\n    return callback();\n  } else {\n    return localUserLoaded = callback;\n  }\n};","init":"//load common js for dashboard webview\n$.loadScript('dashboard/dashboard_model');\n\nOF.loadLocalUser();\n$('body').addClass('textured');\n$('.button').pretouch();\n\n// Menu handling functions\nif (OF.action.isSupported('enableMenuItems')) {\n  OF.sendAction('enableMenuItems', {'items':['home','settings','exit']});\n}\n\nif (!OF.menu) {\n  OF.menu = function(buttonName) {\n    if (typeof OF.menu[buttonName] === 'function')\n    {\n      OF.menu[buttonName]();\n    }\n    else\n    {\n      OF.log('Unknown menu button hit: '+ buttonName);\n    }\n  };\n}\n\nOF.menu.home = function() {\n  if (OF.navigationStack[0].url.match(/dashboard\\/user/)) {\n    OF.goBack({root:true});\n  } else {\n\n    // This is a bit of a hack for now...\n    OF.navigateToUrl(\"dashboard/user\", {\n      complete: function() {\n        OF.pages.unshift(OF.pages.pop());\n        OF.action('back', {root:true}, OF.contentLoaded);\n      }\n    });\n  }\n};\n\nOF.menu.settings = function() {\n  OF.sendAction('openSettings');\n};\n\nOF.menu.exit = function() {\n  OF.sendAction('dismiss');\n};\n\n// Base friends page functions\nif (!OF.friendsList) {\n  OF.friendsList = {\n    init: function() {\n      jQuery.lazyLoad({\n        threshold: 0.5,  //percentage of the window height left to scroll that will trigger the next page\n        nextPageLoaded: function(page, data){ \n          if (page == 1) {\n            OF.friendsList.renderFriends(data);                 \n          } else {\n            OF.friendsList.addFriends(data);         \n          }\n        },\n        nextPageShouldLoad: function(page, callback) {\n          OF.api('/xp/friends', {\n            params: {\n              user_id:   OF.page.user.id,\n              page:      page,\n              page_size: 50\n            },\n            success: function(data) {\n              callback(data.users, data.users.length < 50)\n            },\n            failure: function() { callback([]); }\n          });\n        },\n        isEmpty: function() { OF.friendsList.renderFriends([]); },\n        isFinished: function() { jQuery(\"#loading\").hide(); }\n      });\n    },\n    \n    renderFriendItems: function(friends) {\n      var html = jQuery.map(friends, function(friend) {\n       return tmpl('user_tmpl', friend);\n      });\n      return html;\n    },\n    \n    renderFriends : function(friends) {    \n      var html = OF.friendsList.renderFriendItems(friends);\n      \n      if (html.length > 0) {\n        jQuery('#friends_list > ul').html(html.join('')).unhide();\n        jQuery(\"#friends_list .no_data\").hide();\n      } else {\n        jQuery('#friends_list > ul').hide();\n        jQuery(\"#friends_list .no_data\").unhide();      \n      }\n    },\n    \n    addFriends : function(friends) {    \n      var html = OF.friendsList.renderFriendItems(friends);\n      jQuery('#friends_list > ul').append(html.join(''));\n    }\n  };\n}\n\n// Go home on touching the logo area\n$('#home_button').touch(OF.menu.home);\n$.loadCss('dashboard/user');\n$.loadScript('dashboard/user');\nwindow.userPage = new UserPage;","resume":"window.userPage.pageUpdate()","appear":"$('#header .title').html(OF.page.title);","disappear":null,"exit":null,"html":"<div id='dashboard'>\n  <div id='header'>\n    <span class='loading'>\n      <span class='spinner'></span>\n    </span>\n    <div class='title' id='home_button'></div>\n  </div>\n            <script type=\"text/plain\" id=\"locaLUser\">\n              <div id=\"user_info\" class=\"user_info\">\n      <div class=\"avatar\" style=\"<%=avatarStyle()%>\">\n        <div class=\"overlay\"></div>\n      </div>\n      <div class=\"user_name\"><%=name%></div>\n      <div class=\"playing\">\n        Playing\n        <span class=\"game_name\"></span>\n      </div>\n      <div class=\"notifications\">\n        <div class=\"badge_button friends hidden\" id=\"friends_notification\">\n          <div class=\"badge_icon\">\n            &nbsp;\n          </div>\n          <div class=\"badge\" id=\"pending_friends\"><%=friendNum()%></div>\n        </div>\n        <div class=\"badge_button wall hidden\" id=\"wall_notification\">\n          <div class=\"badge_icon\">\n            &nbsp;\n          </div>\n          <div class=\"badge\" id=\"wall_posts\"><%=wallNum()%></div>\n        </div>\n      </div>\n    </div>\n            </script>\n            <script type=\"text/plain\" id=\"dashboardAnnounceTmpl\">\n              <div data-href=\"dashboard/developer_announcement?from_dashboard=ture&id=<%=id%>\">\n      <div class=\"announce_title\"><%=developer_name%> Announcement</div>\n      <p class=\"announce_subject\"><%=subject%></p>\n    </div>\n            </script>\n            <script type=\"text/plain\" id=\"playerTmplOfUser\">\n              <div class=\"player <%=cssClass()%>\" data-userid=\"<%=id%>\" data-href=\"<%=profileUrl()%>\">\n      <div class=\"small_profile_picture\" style=\"<%=style()%>\">\n        <div class=\"overlay\"></div>\n      </div>\n      <div class=\"username\">\n        <%=name%>\n      </div>\n    </div>\n            </script>\n            <script type=\"text/plain\" id=\"topGameTml\">\n              <div class=\"top_game <%=cssClass()%>\" data-packageName=\"<%=package%>\">\n      <div class=\"game_icon\" style=\"<%=style()%>\"></div>\n    </div>\n            </script>\n  <div class='dashboard_page' id='user_profile'>\n    <div id='header_replacement'>\n      <div id='home_button'></div>\n      <span class='loading'>\n        <span class='spinner'></span>\n        <span class='text'>Loading...</span>\n      </span>\n    </div>\n    <div class='user' id='info_cell'>\n      <div class='loading'>\n        <div class='spinner light'></div>\n      </div>\n      <div class='user_info_container'>\n        <div id='local_user_info'></div>\n        <div class='action_banner action_button' id='action_banner'>\n          <div class='complete_profile message hidden'>\n            Complete profile!\n          </div>\n          <div class='find_friends message hidden'>\n            Invite friends!\n          </div>\n        </div>\n      </div>\n    </div>\n    <ul class='developer_announcement column2_lfixed cells hidden' id='developer_announcement'>\n      <h4 class='section_title'>\n        Developer's Announcement\n      </h4>\n      <li class='announcement' id='announcement'></li>\n    </ul>\n    <ul class='who_else_playing cells hidden' data-href='dashboard/players' id='who_else_playing'>\n      <h4 class='section_title'>\n        Who's Playing\n      </h4>\n      <li class='players'>\n        <div class='playing_title'>\n          Check out their profiles!\n        </div>\n        <div class='touchable_area' id='players'></div>\n      </li>\n    </ul>\n    <div class='hidden' id='unapproved'>\n      This game is under development.  Some Feint Dashboard features may not\n      be functional.\n    </div>\n    <ul class='cells'>\n      <h4 class='section_title'>\n        Game Stats\n      </h4>\n      <li class='hidden' data-href='dashboard/leaderboards' id='leaderboards'>\n        <div class='touchable_area'>\n          <div class='icon'></div>\n          <div class='title'>Leaderboards</div>\n          <div class='subtitle'>See your scores</div>\n        </div>\n      </li>\n      <li class='hidden' id='achievements'>\n        <div class='touchable_area'>\n          <div class='icon'></div>\n          <div class='title'>Achievements</div>\n          <div class='subtitle hidden'></div>\n        </div>\n      </li>\n    </ul>\n    <ul class='cells hidden'>\n      <h4 class='section_title'>\n        Today's Top Games\n      </h4>\n      <li class='top_games'>\n        <div class='touchable_area' id='top_games'></div>\n      </li>\n      <li class='game_channel column2_lfixed'>\n        <div class='touchable_area'>\n          <div class='game_icon left_column'></div>\n          <div class='center_column'>\n            <div class='game_channel_title'>\n              OpenFeint's Game Channel\n            </div>\n            <p class='game_channel_body'>\n              Download now to get even more games!\n            </p>\n          </div>\n        </div>\n      </li>\n    </ul>\n  </div>\n</div>\n"}
